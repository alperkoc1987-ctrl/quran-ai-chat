# Vercel Deployment Guide - Quran AI Chat

This guide provides step-by-step instructions for deploying the Quran AI Chat application to Vercel, a serverless hosting platform that offers free hosting for frontend applications with serverless API functions.

---

## Overview

The application has been converted from an Express.js backend to Vercel Serverless Functions, enabling deployment on Vercel's infrastructure. This architecture provides several advantages including automatic scaling, global CDN distribution, and zero-configuration HTTPS.

### Architecture Changes

The backend has been restructured as follows:

| Component | Previous (Express) | Current (Vercel) |
|-----------|-------------------|------------------|
| Chat API | `/server/_core/index.ts` POST `/api/chat` | `/api/chat.ts` serverless function |
| TTS API | `/server/_core/textToSpeech.ts` POST `/api/tts` | `/api/tts.ts` serverless function |
| Frontend | Served via Express static middleware | Served from `/dist/public` via Vercel CDN |
| Build Output | `dist/` directory | `dist/public/` directory |

---

## Prerequisites

Before deploying to Vercel, ensure you have the following:

1. **GitHub Account** - Your code must be in a GitHub repository
2. **Vercel Account** - Sign up at [vercel.com](https://vercel.com) (free tier available)
3. **OpenAI API Key** - Required for AI chat and TTS functionality

---

## Step 1: Prepare Your Repository

### 1.1 Commit All Changes

Ensure all your changes are committed to your GitHub repository:

```bash
cd /path/to/quran_ai_chat
git add .
git commit -m "Convert backend to Vercel serverless functions"
git push origin main
```

### 1.2 Verify Repository Structure

Your repository should have the following structure:

```
quran_ai_chat/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ chat.ts          # Serverless function for AI chat
â”‚   â””â”€â”€ tts.ts           # Serverless function for text-to-speech
â”œâ”€â”€ client/
â”‚   â”œâ”€â”€ public/          # Static assets
â”‚   â””â”€â”€ src/             # React source code
â”œâ”€â”€ dist/
â”‚   â””â”€â”€ public/          # Build output (generated by `pnpm build`)
â”œâ”€â”€ vercel.json          # Vercel configuration
â”œâ”€â”€ package.json
â””â”€â”€ vite.config.ts
```

---

## Step 2: Configure Vercel Project

### 2.1 Create New Project

1. Go to [vercel.com/new](https://vercel.com/new)
2. Click **"Import Git Repository"**
3. Select your GitHub repository (`quran_ai_chat`)
4. Click **"Import"**

### 2.2 Configure Build Settings

Vercel should automatically detect the configuration from `vercel.json`, but verify the following settings:

| Setting | Value |
|---------|-------|
| **Framework Preset** | Other |
| **Build Command** | `pnpm run build` |
| **Output Directory** | `dist/public` |
| **Install Command** | `pnpm install` |

### 2.3 Add Environment Variables

In the Vercel project settings, add the following environment variable:

| Key | Value | Description |
|-----|-------|-------------|
| `OPENAI_API_KEY` | `sk-geoHuzPn7A9VrxFTr7nw9x` | Your OpenAI API key for chat and TTS |

**Steps to add environment variables:**

1. Go to your Vercel project dashboard
2. Click **"Settings"** â†’ **"Environment Variables"**
3. Add the variable name and value
4. Select **"Production"**, **"Preview"**, and **"Development"** environments
5. Click **"Save"**

---

## Step 3: Deploy

### 3.1 Initial Deployment

1. After configuring the project, click **"Deploy"**
2. Vercel will:
   - Clone your repository
   - Install dependencies with `pnpm install`
   - Build the frontend with `pnpm run build`
   - Deploy the static files to the CDN
   - Deploy the serverless functions from `/api`

3. Wait for the deployment to complete (typically 2-5 minutes)

### 3.2 Verify Deployment

Once deployment is complete, Vercel will provide a URL like:

```
https://quran-ai-chat.vercel.app
```

**Test the following features:**

- âœ… Homepage loads correctly
- âœ… Navigation between pages works
- âœ… AI Chat responds to messages
- âœ… Text-to-Speech (TTS) plays audio
- âœ… Quran search and reading features work
- âœ… Prayer times display correctly

---

## Step 4: Configure Custom Domain (Optional)

If you want to use a custom domain instead of the Vercel subdomain:

### 4.1 Add Domain

1. Go to your Vercel project dashboard
2. Click **"Settings"** â†’ **"Domains"**
3. Enter your custom domain (e.g., `quran-chat.com`)
4. Click **"Add"**

### 4.2 Configure DNS

Vercel will provide DNS configuration instructions. You need to add the following records to your domain registrar:

| Type | Name | Value |
|------|------|-------|
| A | @ | `76.76.21.21` |
| CNAME | www | `cname.vercel-dns.com` |

### 4.3 Verify Domain

After updating DNS records (propagation takes 24-48 hours), Vercel will automatically issue an SSL certificate and your app will be available at your custom domain.

---

## Step 5: Continuous Deployment

Vercel automatically deploys your app whenever you push changes to GitHub:

1. Make changes to your code locally
2. Commit and push to GitHub:
   ```bash
   git add .
   git commit -m "Update feature X"
   git push origin main
   ```
3. Vercel automatically detects the push and triggers a new deployment
4. Monitor the deployment progress in the Vercel dashboard

---

## Troubleshooting

### Issue: Build Fails

**Symptoms:** Deployment fails during the build step

**Solutions:**

1. Check the build logs in Vercel dashboard
2. Verify `package.json` has correct dependencies
3. Ensure `vite.config.ts` output directory is set to `dist/public`
4. Try building locally first: `pnpm run build`

### Issue: API Functions Return 500 Error

**Symptoms:** Chat or TTS features don't work, console shows 500 errors

**Solutions:**

1. Verify `OPENAI_API_KEY` environment variable is set correctly
2. Check function logs in Vercel dashboard: **"Deployments"** â†’ **"Functions"**
3. Ensure API key has sufficient credits and correct permissions
4. Test API key directly with OpenAI's API

### Issue: Static Assets Not Loading

**Symptoms:** Images, fonts, or CSS files return 404 errors

**Solutions:**

1. Verify `vercel.json` has correct rewrite rules
2. Check that `dist/public` directory contains all assets after build
3. Ensure asset paths in code use absolute paths (e.g., `/assets/logo.png`)

### Issue: Environment Variables Not Working

**Symptoms:** Features that depend on environment variables fail

**Solutions:**

1. Verify environment variables are set in Vercel dashboard
2. Ensure variables are enabled for the correct environment (Production/Preview/Development)
3. Redeploy after adding/changing environment variables
4. Check that variable names match exactly (case-sensitive)

---

## Performance Optimization

### Enable Edge Caching

Add caching headers to static assets in `vercel.json`:

```json
{
  "headers": [
    {
      "source": "/assets/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    }
  ]
}
```

### Monitor Function Performance

1. Go to Vercel dashboard â†’ **"Analytics"**
2. Monitor function execution time and error rates
3. Optimize slow functions by:
   - Reducing API call timeouts
   - Implementing caching for repeated requests
   - Minimizing cold start times

---

## Cost Considerations

Vercel's **Free Tier** includes:

- âœ… Unlimited static hosting
- âœ… 100 GB bandwidth per month
- âœ… 100 GB-hours of serverless function execution
- âœ… Automatic HTTPS
- âœ… Global CDN

**Estimated Usage for Quran AI Chat:**

| Resource | Usage per Request | Free Tier Limit | Estimated Requests |
|----------|-------------------|-----------------|-------------------|
| Bandwidth | ~500 KB | 100 GB/month | ~200,000 requests |
| Function Execution | ~1 second | 100 GB-hours | ~360,000 requests |

For most users, the free tier is sufficient. If you exceed limits, Vercel offers paid plans starting at $20/month.

---

## Security Best Practices

### Protect API Keys

1. **Never commit API keys to Git** - Use environment variables only
2. **Rotate keys regularly** - Change your OpenAI API key every 3-6 months
3. **Monitor usage** - Check OpenAI dashboard for unexpected usage spikes

### Enable Rate Limiting

Consider implementing rate limiting for API functions to prevent abuse:

```typescript
// Example rate limiting logic in api/chat.ts
const rateLimitMap = new Map<string, number>();

export default async function handler(req: VercelRequest, res: VercelResponse) {
  const ip = req.headers['x-forwarded-for'] || req.socket.remoteAddress;
  const requestCount = rateLimitMap.get(ip) || 0;
  
  if (requestCount > 100) {
    return res.status(429).json({ error: 'Too many requests' });
  }
  
  rateLimitMap.set(ip, requestCount + 1);
  // ... rest of handler logic
}
```

---

## Next Steps

After successful deployment, consider these enhancements:

1. **Analytics** - Add Vercel Analytics to track user behavior
2. **Error Monitoring** - Integrate Sentry or similar service for error tracking
3. **Progressive Web App (PWA)** - Add service worker for offline functionality
4. **Mobile App** - Use Capacitor to convert to native iOS/Android app
5. **Internationalization** - Add support for more languages (Turkish, Arabic, Urdu)

---

## Support and Resources

- **Vercel Documentation**: [vercel.com/docs](https://vercel.com/docs)
- **OpenAI API Documentation**: [platform.openai.com/docs](https://platform.openai.com/docs)
- **Vercel Community**: [github.com/vercel/vercel/discussions](https://github.com/vercel/vercel/discussions)

---

**Deployment completed successfully!** Your Quran AI Chat app is now live on Vercel with no registration requirements for users. ðŸš€
